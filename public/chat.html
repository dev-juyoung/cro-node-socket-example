<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <title>Cro Node Socket Example</title>
    <link rel="stylesheet" type="text/css" href="./stylesheets/style.css">
  </head>
  <body>
    <ul id="messages">
      <li>
        <div class="receive-container">
          <div class="receive-nickname">타인의 닉네임</div>
          <div class="receive-message">타인의 메시지</div>
        </div>
      </li>
      <li>
        <div class="self-message">본인의 메시지</div>
      </li>
      <li>
        <div class="system-message">접속자 및 퇴장자 알림 메시지</div>
      </li>
    </ul>
    <form action="">
      <textarea id="message"></textarea>
      <button id="send-button" disabled>전송</button>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>
      $(() => {
        const socket = io();

        $('#message').keydown(onKeyDown);
        $('#message').keyup(onKeyUp);
        $('form').submit(onSubmit);
      });

      // TextArea의 KeyDown 이벤트 처리.
      // 키조합에 따른 동작을 처리한다.
      function onKeyDown(event) {
        if (event.keyCode == 13 && event.shiftKey) {
          console.log('keydown is shift + enter');
          return;
        } else if (event.keyCode == 13) {
          event.preventDefault();
          $('form').submit(onSubmit());
        }
      }

      // TextArea의 KeyUp 이벤트 처리.
      // 입력된 데이터의 길이를 확인하여, Button의 enable & disable을 처리한다.
      function onKeyUp() {
        const length = $(this).val().length;

        if (length == 0) {
          $('#send-button').prop('disabled', true);
        } else {
          $('#send-button').prop('disabled', false);
        }
      }

      // 서버로 메시지를 전송한다.
      function onSubmit() {
        const sendMessage = $('#message').val();
        
        if (!sendMessage) {
          console.log('전달할 메시지가 없으므로, 서버로 전송하지 않는다.');
          return false;
        }

        // 메시지 전송 후, Textarea 빈값으로 초기화.
        $('#message').val('');
        return false;
      }
    </script>
  </body>
</html>